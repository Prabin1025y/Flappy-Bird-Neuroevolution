var z=Object.defineProperty;var O=(s,t,o)=>t in s?z(s,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[t]=o;var i=(s,t,o)=>O(s,typeof t!="symbol"?t+"":t,o);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const h of n)if(h.type==="childList")for(const y of h.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&r(y)}).observe(document,{childList:!0,subtree:!0});function o(n){const h={};return n.integrity&&(h.integrity=n.integrity),n.referrerPolicy&&(h.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?h.credentials="include":n.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function r(n){if(n.ep)return;n.ep=!0;const h=o(n);fetch(n.href,h)}})();class b{constructor(t){i(this,"x",200);i(this,"y");i(this,"velocity");i(this,"flapping_force",10);i(this,"gravity",.4);i(this,"fitness");i(this,"alive");i(this,"nextPipe",null);i(this,"score");i(this,"brain");i(this,"update",t=>{this.y+=this.velocity,this.velocity+=this.gravity,this.velocity*=.95,this.fitness++,this.y>e.height-30&&(this.y=e.height-10,this.velocity=0,this.die()),this.y<0&&(this.y=0,this.velocity=0,this.die()),this.checkPipe(t),this.think()});i(this,"checkPipe",t=>{for(const o of t){if(o.x+o.width>this.x){this.nextPipe=o,o.color="red";break}o.color="green"}for(const o of t)!o.passed&&o.x+o.width<this.x&&(this.fitness+=100,o.passed=!0,this.score++,console.log("Cleared"));this.nextPipe&&(this.y<this.nextPipe.y_top||this.y>this.nextPipe.y_top+this.nextPipe.gap)&&this.x>this.nextPipe.x&&this.x<this.nextPipe.x+this.nextPipe.width&&this.die()});i(this,"think",()=>{if(!this.nextPipe)return;let t=[this.y/e.height,this.velocity/10,this.nextPipe.y_top/e.height,(this.nextPipe.x-this.x)/e.width];this.brain.classifySync(t)[0].label==="flap"&&this.flap()});i(this,"die",()=>{this.alive=!1,this.fitness-=10});i(this,"flap",()=>{this.velocity-=this.flapping_force});i(this,"draw",()=>{e.push(),e.noStroke(),e.fill("yellow"),e.translate(this.x,this.y),e.image(N,-15,-12,30,25),e.pop()});t?this.brain=t.copy():this.brain=ml5.neuralNetwork({inputs:4,outputs:["flap","no_flap"],task:"classification",neuroEvolution:!0}),this.y=e.height/2,this.velocity=0,this.fitness=0,this.alive=!0,this.score=0}}class g{constructor(){i(this,"x");i(this,"y_top");i(this,"velocity",2);i(this,"gap",150);i(this,"width",40);i(this,"color","green");i(this,"passed",!1);i(this,"update",()=>{this.x-=this.velocity});i(this,"draw",()=>{e.push(),e.fill(255,0,0,100),e.noStroke(),e.image(w,this.x-10,this.y_top+this.gap,this.width+20,e.height-this.y_top-this.gap),e.scale(1,-1),e.image(w,this.x-10,-this.y_top,this.width+20,this.y_top),e.pop()});this.x=e.width,this.y_top=e.random(50,e.height-this.gap-50)}}class c{constructor(t){i(this,"x");i(this,"y");i(this,"velocity",2);i(this,"width",574);i(this,"height",30);i(this,"update",()=>{this.x-=this.velocity,this.x<-this.width&&(this.x+=3*this.width)});i(this,"draw",()=>{e.push(),e.image(C,this.x,this.y,this.width,this.height),e.pop()});this.x=t,this.y=e.height-30}}const m=document.getElementById("population-size"),A=document.getElementById("population-size-value"),k=document.getElementById("simulation-speed"),T=document.getElementById("simulation-speed-value"),v=document.getElementById("start-btn"),F=document.getElementById("reset-btn"),I=document.getElementById("generation"),P=document.getElementById("best-score"),S=document.getElementById("birds-alive");var L;let G=((L=document.getElementById("game-container"))==null?void 0:L.offsetWidth)||800;var _;let M=((_=document.getElementById("game-container"))==null?void 0:_.offsetHeight)||500,x=!1;m.addEventListener("input",function(){A.textContent=this.value});k.addEventListener("input",function(){T.textContent=`${this.value}x`});v.addEventListener("click",function(){this.classList.add("active"),setTimeout(()=>this.classList.remove("active"),200),x?(x=!1,e.noLoop(),v.innerText="Resume"):(x=!0,e.loop(),v.innerText="Pause")});F.addEventListener("click",function(){this.classList.add("active"),setTimeout(()=>this.classList.remove("active"),200),d=Number(m.value),a=[],l=[],l.push(new g);for(let s=0;s<d;s++)a[s]=new b;p=d,u=[new c(0),new c(574),new c(2*574),new c(3*574)],E=1,f=0});let e,a,l,u,d,E=1,p,f=0,B,N,w,C;const V=s=>{e=s,e.preload=()=>{B=e.loadImage("bg.png"),N=e.loadImage("bird.png"),w=e.loadImage("pipe.png"),C=e.loadImage("ground.png"),e.noLoop()},e.setup=()=>{ml5.setBackend("cpu"),e.createCanvas(G,M).parent("game-container"),d=Number(m.value),a=[],l=[],l.push(new g);for(let n=0;n<d;n++)a[n]=new b;p=d,u=[new c(0),new c(574),new c(2*574),new c(3*574)]},e.draw=()=>{for(let r=0;r<Number(k.value);r++){d=Number(m.value),l[l.length-1].x<e.width-300&&l.push(new g),l.forEach(n=>{n.x<-300&&l.splice(0,1),n.update()}),o()&&q(),p=0,a.forEach(n=>{n.alive&&(p++,n.update(l),n.score>f&&(f=n.score))});for(const n of u)n.update()}t(),R({generation:E,bestScore:f,birdsAlive:p})};const t=()=>{e.background(B);for(const r of l)r.draw();for(const r of a)r.alive&&r.draw();for(const r of u)r.draw()},o=()=>{for(const r of a)if(r.alive)return!1;return!0}},q=()=>{D(),H();let s=[];for(let t=0;t<d;t++){let o=K();o.mutate(.01),s[t]=new b(o)}a=s,E++},D=()=>{l=[],l.push(new g)},H=()=>{let s=0;for(const t of a)s+=t.fitness;for(const t of a)t.fitness/=s},K=()=>{let s=0,t=e.random(1);for(;t>0;)t=t-a[s].fitness,s++;return s--,a[s].brain},R=s=>{I&&(I.textContent=s.generation.toString()),P&&(P.textContent=s.bestScore.toString()),S&&(S.textContent=s.birdsAlive.toString())};new p5(V);
